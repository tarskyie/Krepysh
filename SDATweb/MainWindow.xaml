<?xml version="1.0" encoding="utf-8"?>
<Window
    x:Class="SDATweb.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:SDATweb"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:muxc="using:Microsoft.UI.Xaml.Controls"
    mc:Ignorable="d"
    Title="Krepysh App">

    <Window.SystemBackdrop>
        <MicaBackdrop Kind="Base"/>
    </Window.SystemBackdrop>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="32"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="1.2*"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- Title Bar -->
        <Grid x:Name="AppTitleBar" Grid.Row="0" Grid.ColumnSpan="2">
            <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Margin="8,0">
                <Image Source="Assets/WebLogo.png"
                       Width="16" Height="16" 
                       Margin="0,0,12,0"/>
                <TextBlock x:Name="AppTitleTextBlock" 
                           Text="Krepysh App"
                           TextWrapping="NoWrap"
                           Style="{StaticResource CaptionTextBlockStyle}" 
                           VerticalAlignment="Center"/>
            </StackPanel>
        </Grid>

        <!-- Top Command Bar -->
        <CommandBar Grid.Row="1" Grid.ColumnSpan="2" DefaultLabelPosition="Right" HorizontalAlignment="Left">
            <AppBarButton Label="Open in Edge" Click="OpenIndex">
                <AppBarButton.Icon>
                    <FontIcon Glyph="&#xE774;"/>
                </AppBarButton.Icon>
            </AppBarButton>
            <AppBarButton Icon="Save" Label="Build &amp; save" Click="BuildWebsite" 
                          Style="{StaticResource AppBarButtonRevealStyle}"/>
            <AppBarButton Icon="Add" Label="New page" Click="NewPage"/>
            <AppBarButton Icon="Remove" Label="Remove page" Click="RemovePage"/>
            <AppBarButton Icon="Delete" Label="Clear" Click="ClearItems"/>
            <AppBarButton Icon="Folder" Label="Open Folder" Click="OpenDirectory"/>

            <AppBarSeparator/>

            <AppBarElementContainer VerticalContentAlignment="Center">
                <StackPanel Orientation="Horizontal" Spacing="8" Margin="8,0">
                    <TextBox x:Name="urlBox" 
                             Width="280" 
                             VerticalAlignment="Center" 
                             Text="http://127.0.0.1:8080/v1/chat/completions" 
                             PlaceholderText="API URL"
                             Header="API Endpoint">
                        <TextBox.HeaderTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal" Spacing="4">
                                    <FontIcon FontSize="12" Glyph="&#xE774;" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                    <TextBlock Text="API Endpoint" Style="{StaticResource CaptionTextBlockStyle}"/>
                                </StackPanel>
                            </DataTemplate>
                        </TextBox.HeaderTemplate>
                    </TextBox>
                    <PasswordBox x:Name="keyBox" 
                             Width="140" 
                             VerticalAlignment="Center" 
                             PlaceholderText="API Key"
                             
                             Header="Key">
                        <PasswordBox.HeaderTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal" Spacing="4">
                                    <FontIcon FontSize="12" Glyph="&#xE192;" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                    <TextBlock Text="Key" Style="{StaticResource CaptionTextBlockStyle}"/>
                                </StackPanel>
                            </DataTemplate>
                        </PasswordBox.HeaderTemplate>
                    </PasswordBox>
                </StackPanel>
            </AppBarElementContainer>
        </CommandBar>

        <!-- Pages List -->
        <Grid Grid.Row="2" Grid.Column="0" Margin="12,8,6,12">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <TextBlock Text="Pages" 
                       Style="{StaticResource SubtitleTextBlockStyle}" 
                       Margin="4,0,0,8"/>

            <ListBox x:Name="lb_pages" 
                 Grid.Row="1"
                 CornerRadius="8"
                 BorderThickness="1"
                 BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                 Background="{ThemeResource CardBackgroundFillColorDefaultBrush}">
                <ListBox.ItemTemplate>
                    <DataTemplate>
                        <Grid Margin="0,8" RowSpacing="8">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <!-- Prompt Section -->
                            <Grid Grid.Row="0" ColumnSpacing="8">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <TextBox Grid.Column="0" 
                             PlaceholderText="Enter AI prompt..."
                             Header="AI Prompt">
                                    <TextBox.HeaderTemplate>
                                        <DataTemplate>
                                            <StackPanel Orientation="Horizontal" Spacing="4">
                                                <FontIcon FontSize="12" Glyph="&#xE8F8;" Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"/>
                                                <TextBlock Text="AI Prompt" Style="{StaticResource CaptionTextBlockStyle}"/>
                                            </StackPanel>
                                        </DataTemplate>
                                    </TextBox.HeaderTemplate>
                                </TextBox>
                                <Button Grid.Column="1" 
                            Click="SendRequest"
                            Style="{StaticResource AccentButtonStyle}"
                            VerticalAlignment="Bottom"
                            ToolTipService.ToolTip="Send Request">
                                    <StackPanel Orientation="Horizontal" Spacing="8">
                                        <FontIcon Glyph="&#xE724;" FontSize="16"/>
                                        <TextBlock Text="Send"/>
                                    </StackPanel>
                                </Button>
                            </Grid>

                            <!-- Page Name - BOUND TO DATA -->
                            <TextBox Grid.Row="1"
                         Text="{Binding Name, Mode=TwoWay}" 
                         PlaceholderText="Page name" 
                         TextChanged="TextBox_NameChanged"
                         Header="Page Name">
                                <TextBox.HeaderTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Horizontal" Spacing="4">
                                            <FontIcon FontSize="12" Glyph="&#xE8A5;" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                            <TextBlock Text="Page Name" Style="{StaticResource CaptionTextBlockStyle}"/>
                                        </StackPanel>
                                    </DataTemplate>
                                </TextBox.HeaderTemplate>
                            </TextBox>

                            <!-- HTML Content - BOUND TO DATA -->
                            <TextBox Grid.Row="2"
                         Height="160" 
                         AcceptsReturn="True" 
                         TextWrapping="Wrap" 
                         TextChanged="TextBox_TextChanged"
                         Text="{Binding Content, Mode=TwoWay}"
                         FontFamily="Consolas"
                         Header="HTML Content">
                                <TextBox.HeaderTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Horizontal" Spacing="4">
                                            <FontIcon FontSize="12" Glyph="&#xE943;" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                            <TextBlock Text="HTML Content" Style="{StaticResource CaptionTextBlockStyle}"/>
                                        </StackPanel>
                                    </DataTemplate>
                                </TextBox.HeaderTemplate>
                            </TextBox>
                        </Grid>
                    </DataTemplate>
                </ListBox.ItemTemplate>
            </ListBox>
        </Grid>

        <!-- Right Panel -->
        <ScrollViewer Grid.Row="2" Grid.Column="1" Margin="6,8,12,12">
            <StackPanel Spacing="8">

                <TextBlock Text="Configuration" 
                   Style="{StaticResource SubtitleTextBlockStyle}" 
                   Margin="4,0,0,0"/>

                <!-- Accordion container -->
                <StackPanel>
                    <muxc:Expander Header="Website settings" HorizontalAlignment="Stretch"  IsExpanded="True" Margin="0,8,0,0">
                        <StackPanel Spacing="4">
                            <TextBox x:Name="nameBox" 
                                 Text="Website" 
                                 PlaceholderText="Website Name"
                                 Header="Website Name">
                                <TextBox.HeaderTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Horizontal" Spacing="4">
                                            <FontIcon FontSize="12" Glyph="&#xE774;" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                            <TextBlock Text="Website Name" Style="{StaticResource CaptionTextBlockStyle}"/>
                                        </StackPanel>
                                    </DataTemplate>
                                </TextBox.HeaderTemplate>
                            </TextBox>

                            <TextBlock Style="{StaticResource CaptionTextBlockStyle}">Icon</TextBlock>
                            <Grid ColumnSpacing="8">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBox x:Name="iconBox" 
                                     Grid.Column="0"
                                     PlaceholderText="Select icon file..."/>
                                <Button Grid.Column="1" 
                                    Click="SelectIcon"
                                    ToolTipService.ToolTip="Browse for icon">
                                    <FontIcon Glyph="&#xE8B7;"/>
                                </Button>
                            </Grid>

                            <CheckBox x:Name="indexToggle" IsChecked="True">
                                <TextBlock TextWrapping="Wrap" Text="index.html redirects to the first page (if present)"/>
                            </CheckBox>
                        </StackPanel>
                    </muxc:Expander>

                    <muxc:Expander Header="CSS Styles" HorizontalAlignment="Stretch" IsExpanded="False" Margin="0,4,0,0">
                        <TextBox x:Name="cssBox" 
                             Height="320" 
                             AcceptsReturn="True" 
                             TextWrapping="Wrap"
                             Text="body {&#xD;&#xA;    font-family: Arial, sans-serif;&#xD;&#xA;    margin: 20px;&#xD;&#xA;    background-color: #f4f4f4;&#xD;&#xA;}&#xD;&#xA;h1 {&#xD;&#xA;    color: #333;&#xD;&#xA;}&#xD;&#xA;p {&#xD;&#xA;    line-height: 1.6;&#xD;&#xA;}"
                             FontFamily="Consolas"
                             Header="CSS Styles">
                            <TextBox.HeaderTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal" Spacing="4">
                                        <FontIcon FontSize="12" Glyph="&#xE943;" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                        <TextBlock Text="CSS Styles" Style="{StaticResource CaptionTextBlockStyle}"/>
                                    </StackPanel>
                                </DataTemplate>
                            </TextBox.HeaderTemplate>
                        </TextBox>
                    </muxc:Expander>

                    <muxc:Expander Header="Assets" HorizontalAlignment="Stretch" IsExpanded="False" Margin="0,4,0,0">
                        <StackPanel Spacing="8">
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <Button Click="AddAsset">
                                    <StackPanel Orientation="Horizontal" Spacing="8">
                                        <FontIcon Glyph="&#xE710;" FontSize="14"/>
                                        <TextBlock Text="Add Asset"/>
                                    </StackPanel>
                                </Button>
                                <Button Click="ClearAssets">
                                    <StackPanel Orientation="Horizontal" Spacing="8">
                                        <FontIcon Glyph="&#xE74D;" FontSize="14"/>
                                        <TextBlock Text="Clear All"/>
                                    </StackPanel>
                                </Button>
                            </StackPanel>

                            <ListBox x:Name="lb_assets" 
                                 MinHeight="200"
                                 MaxHeight="300"
                                 CornerRadius="4"
                                 BorderThickness="1"
                                 BorderBrush="{ThemeResource ControlStrokeColorDefaultBrush}"/>
                        </StackPanel>
                    </muxc:Expander>

                </StackPanel>
            </StackPanel>
        </ScrollViewer>

    </Grid>
</Window>